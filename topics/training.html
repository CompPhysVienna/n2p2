

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NNP training procedure &mdash; n2p2 - A neural network potential package &#34;e6a46df&#34; documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2b224a83"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Units" href="units.html" />
    <link rel="prev" title="Configuration file format" href="cfg_file.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            n2p2 - A neural network potential package
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="build.html">Build instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="descriptors.html">Atomic environment descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="keywords.html">NNP configuration: keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="cfg_file.html">Configuration file format</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NNP training procedure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1-data-set">Step 1: Data set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-prepare-settings-file">Step 2: Prepare settings file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-optional-data-set-normalization">Step 3 (<strong>optional</strong>): Data set normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-symmetry-function-setup">Step 4: Symmetry function setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-compute-symmetry-function-statistics">Step 5: Compute symmetry function statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-6-nnp-training">Step 6: NNP Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-7-collect-weight-files">Step 7: Collect weight files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-8-prediction-and-md-simulation">Step 8: Prediction and MD simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfaces</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/if_lammps.html">LAMMPS interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/if_cabanamd.html">CabanaMD interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/libnnp.html">The libnnp core library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-atomenv.html">nnp-atomenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-checkf.html">nnp-checkf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-convert.html">nnp-convert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-norm.html">nnp-norm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-predict.html">nnp-predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-prune.html">nnp-prune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-select.html">nnp-select</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-scaling.html">nnp-scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nnp-train.html">nnp-train</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/cabanamd_build_example.html">CabanaMD GPU build example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/cg_descriptor_analysis.html">Descriptor analysis/Coarse-graining</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/neural_network.html">Neural network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/cutoff_functions.html">Cutoff functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/symmetry_function_types.html">Symmetry function types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/symmetry_function_scaling.html">Symmetry function scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/memory_layout.html">Memory layout</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/how_to_cite.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">n2p2 - A neural network potential package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">NNP training procedure</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/topics/training.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nnp-training-procedure">
<span id="training"></span><h1>NNP training procedure<a class="headerlink" href="#nnp-training-procedure" title="Link to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This part of the documentation is incomplete!</p>
</div>
<p>Creating a new high-dimensional neural network potential from scratch is
usually a multi-step iterative procedure which includes</p>
<ul class="simple">
<li><p>data set generation/augmentation,</p></li>
<li><p>selection/refinement/pruning of symmetry function parameters,</p></li>
<li><p>experimenting with neural network topology/settings,</p></li>
<li><p>the actual neural network training, i.e. optimizing the weight parameters.</p></li>
</ul>
<p>Tools are ready-made for most of these tasks and can be combined to generate a
new NNP from scratch. Here is a rough guideline of the individual steps from a
set of configurations to an initial NN potential. However, be aware that
creating a reliable NNP usually requires repeated data set refining and adequate
testing before it is ready for production!</p>
<section id="step-1-data-set">
<h2>Step 1: Data set<a class="headerlink" href="#step-1-data-set" title="Link to this heading"></a></h2>
<p>Prepare a data set (name the file <code class="docutils literal notranslate"><span class="pre">input.data</span></code>) in the file format described
<a class="reference internal" href="cfg_file.html#cfg-file"><span class="std std-ref">here</span></a>. Unfortunately there’s no simple recipe how to create a
“good” set of configurations, you will find more hints in the literature. As a
starting point you could try with some (100+) configurations taken from an <em>ab
initio</em> MD simulation.</p>
</section>
<section id="step-2-prepare-settings-file">
<h2>Step 2: Prepare settings file<a class="headerlink" href="#step-2-prepare-settings-file" title="Link to this heading"></a></h2>
<p>Prepare a settings file (name the file <code class="docutils literal notranslate"><span class="pre">input.nn</span></code>): Use the recommended file
<a class="reference external" href="https://github.com/CompPhysVienna/n2p2/blob/master/examples/input.nn.recommended">here</a>
and change the settings in the “GENERAL NNP SETTINGS” section according to
your system.</p>
</section>
<section id="step-3-optional-data-set-normalization">
<h2>Step 3 (<strong>optional</strong>): Data set normalization<a class="headerlink" href="#step-3-optional-data-set-normalization" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step is usually not necessary any more because data set normalization is
handled on-the-fly during training with the keyword
<a class="reference internal" href="keywords.html#normalize-data-set"><span class="std std-ref">normalize_data_set</span></a>.</p>
</div>
<p>As explained <a class="reference internal" href="units.html#units"><span class="std std-ref">here</span></a> it may be useful to ensure that training is
independent of the chosen unit system. With <code class="docutils literal notranslate"><span class="pre">input.nn</span></code> and <code class="docutils literal notranslate"><span class="pre">input.data</span></code>
present run the tool <a class="reference internal" href="../tools/nnp-norm.html#nnp-norm"><span class="std std-ref">nnp-norm</span></a> which implements a normalization procedure
(see chapter 3.1 in <a class="footnote-reference brackets" href="#id7" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>) for this purpose. This will write an additional header
to the settings file <code class="docutils literal notranslate"><span class="pre">input.nn</span></code> with three new keyword-value pairs. These will
instruct other n2p2 tools to enable the data set normalization during runtime.
Whenever the data set is changed, do not forget to repeat this step.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Besides the addition of the normalization header no other actions are required
to enable data set normalization for all other steps below. In particular,
neither the data set nor other unit system dependent settings (e.g. cutoff
radii, some symmetry function parameters) need to be converted manually. Any
unit conversion will be handled internally and no user intervention is
necessary.</p>
</div>
</section>
<section id="step-4-symmetry-function-setup">
<span id="symfunc-setup"></span><h2>Step 4: Symmetry function setup<a class="headerlink" href="#step-4-symmetry-function-setup" title="Link to this heading"></a></h2>
<p>Change the symmetry function definitions in the “SYMMETRY FUNCTIONS” section of
the <code class="docutils literal notranslate"><span class="pre">input.nn</span></code> file.. again this not a trivial task, please find more
information in the literature <a class="footnote-reference brackets" href="#id8" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#id9" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#id10" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. See also the description of the
<code class="docutils literal notranslate"><span class="pre">symfunction_short</span></code> keyword <a class="reference internal" href="keywords.html#keywords"><span class="std std-ref">here</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a very useful standalone Python tool written by Florian Buchner (see
his <a class="reference external" href="https://github.com/CompPhysVienna/n2p2/pull/15">pull request</a>) which
allows to create sets of symmetry function lines following the guidelines
given in <a class="footnote-reference brackets" href="#id9" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> and <a class="footnote-reference brackets" href="#id10" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. To use it, just copy the file <a class="reference external" href="https://github.com/flobuch/n2p2/blob/symfunc_paramgen/tools/python/symfunc_paramgen/src/sfparamgen.py">sfparamgen.py</a>
to a local directory and follow the instructions given in this <a class="reference external" href="https://github.com/flobuch/n2p2/blob/symfunc_paramgen/tools/python/symfunc_paramgen/examples/example.ipynb">Jupyter
notebook</a>.</p>
</div>
</section>
<section id="step-5-compute-symmetry-function-statistics">
<h2>Step 5: Compute symmetry function statistics<a class="headerlink" href="#step-5-compute-symmetry-function-statistics" title="Link to this heading"></a></h2>
<p>With the files <code class="docutils literal notranslate"><span class="pre">input.data</span></code> and <code class="docutils literal notranslate"><span class="pre">input.nn</span></code> ready in the same directoy, run
the tool <code class="docutils literal notranslate"><span class="pre">nnp-scaling</span></code> (supports MPI parallelization). This will compute all
symmetry functions for all atoms once and store statistics about them in a
third file (<code class="docutils literal notranslate"><span class="pre">scaling.data</span></code>) required for training.</p>
</section>
<section id="step-6-nnp-training">
<h2>Step 6: NNP Training<a class="headerlink" href="#step-6-nnp-training" title="Link to this heading"></a></h2>
<p>Run the actual training program <code class="docutils literal notranslate"><span class="pre">nnp-train</span></code>, preferably in parallel via:
<code class="docutils literal notranslate"><span class="pre">mpirun</span> <span class="pre">-np</span> <span class="pre">16</span> <span class="pre">nnp-train</span></code> Be aware of the memory footprint which is estimated
in the previous step (see end of log file or screen output).</p>
</section>
<section id="step-7-collect-weight-files">
<h2>Step 7: Collect weight files<a class="headerlink" href="#step-7-collect-weight-files" title="Link to this heading"></a></h2>
<p>Upon training weight files are created for each epoch <code class="docutils literal notranslate"><span class="pre">weights.???.&lt;epoch&gt;</span></code>.
Select an epoch with satisfying RMSE and rename the corresponding weight
files to <code class="docutils literal notranslate"><span class="pre">weights.???.data</span></code> (<code class="docutils literal notranslate"><span class="pre">???</span></code> is the atomic number of elements
occurring).</p>
</section>
<section id="step-8-prediction-and-md-simulation">
<h2>Step 8: Prediction and MD simulation<a class="headerlink" href="#step-8-prediction-and-md-simulation" title="Link to this heading"></a></h2>
<p>Try the potential by predicting energies and forces for a new configuration:
Collect the files from training (<code class="docutils literal notranslate"><span class="pre">input.nn</span></code>, <code class="docutils literal notranslate"><span class="pre">scaling.data</span></code> and
<code class="docutils literal notranslate"><span class="pre">weights.???</span></code>) in a folder together with a single configuration (named again
<code class="docutils literal notranslate"><span class="pre">input.data</span></code>) and run the tool <code class="docutils literal notranslate"><span class="pre">nnp-predict</span></code>. Alternatively, try to run a MD
simulation with LAMMPS (see setup instructions <a class="reference internal" href="../interfaces/if_lammps.html#if-lammps"><span class="std std-ref">here</span></a>).</p>
<p>Please also have a look at the <code class="docutils literal notranslate"><span class="pre">examples</span></code> directory which provides working
example setups for each tool. If there are problems don’t hesitate to ask
again…</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id7" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Singraber, A.; Morawietz, T.; Behler, J.; Dellago, C. Parallel
Multistream Training of High-Dimensional Neural Network Potentials. J. Chem.
Theory Comput. 2019, 15 (5), 3075–3092. <a class="reference external" href="https://doi.org/10.1021/acs.jctc.8b01092">https://doi.org/10.1021/acs.jctc.8b01092</a></p>
</aside>
<aside class="footnote brackets" id="id8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Behler, J. Atom-Centered Symmetry Functions for Constructing
High-Dimensional Neural Network Potentials. J. Chem. Phys. 2011, 134 (7),
074106. <a class="reference external" href="https://doi.org/10.1063/1.3553717">https://doi.org/10.1063/1.3553717</a></p>
</aside>
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id3">1</a>,<a role="doc-backlink" href="#id5">2</a>)</span>
<p>Imbalzano, G.; Anelli, A.; Giofré, D.; Klees, S.; Behler, J.; Ceriotti,
M. Automatic Selection of Atomic Fingerprints and Reference Configurations for
Machine-Learning Potentials. J. Chem. Phys. 2018, 148 (24), 241730.
<a class="reference external" href="https://doi.org/10.1063/1.5024611">https://doi.org/10.1063/1.5024611</a></p>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id4">1</a>,<a role="doc-backlink" href="#id6">2</a>)</span>
<p>Gastegger, M.; Schwiedrzik, L.; Bittermann, M.; Berzsenyi, F.;
Marquetand, P. WACSF—Weighted Atom-Centered Symmetry Functions as Descriptors in
Machine Learning Potentials. J. Chem. Phys. 2018, 148 (24), 241709.
<a class="reference external" href="https://doi.org/10.1063/1.5019667">https://doi.org/10.1063/1.5019667</a></p>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cfg_file.html" class="btn btn-neutral float-left" title="Configuration file format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="units.html" class="btn btn-neutral float-right" title="Units" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Andreas Singraber.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>